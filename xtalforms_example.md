# The xtalform.yaml file

THe purpose of the xtalform yaml is to specify the exact crystalform that is being worked with. 

Two datasets are said to belong to the same crystalform if:
 - They have similar unit cell parameters (a,b,c,alpha,beta,gamma)
 - The same spacegroup

The alignment code will assign each crystal to the user entered xtalform which has the closest unit cell paramaters and the same spacegroup.

The xtalform yaml also specifies which biological assemblies are present in a crystalform. 

The simplest xtalform has a single chain in the biological assembly:

```yaml
"xtalforms":  # All xtalform yamls begin with this key
  "0":  # The name of the xtalform: must be unique
    "id": 0  # The numerical id of the xtalform: must be unique
    "reference":  # The dtag of the reference dataset which this xtalform is based on
      "dtag": "5rgs" 
    "assemblies":  # The biological assemblies present in this crystalform, and the operations which relate them
                   # to the reference dataset
      "0":  # The name of the assembly: must be unique within this xtalform
        "id": 0  # The numerical id of the assembly: must be unique within this xtalform
        "reference_assembly": 0  # Ignore
        "generators":  # A list of the symmetry operations which generate the assembly in the reference from 
                       # chains in datasets to be aligned
          "0":  # The name of the generator: must be unique within assembly
            "id": 0  # The numerical id of the generator: must be unique within assembly
            "reference_chain": "A"  # The name of the chain in the assembly that will be generated from datasets in 
                                    # this crystalform
            "chain": "A"  # The name of the chain in datasets to be aligned
            "triplet": "x,y,z"  # The symmetry operation which generates the reference chain from the dataset chain
                                # In this case there is only a single 
  ```

A slightly more complicated example might feature a bioloigcal assembly with two chains - a dimer - only one of which is given in the pdb, and the other is generated by a crystallographic symmetry operation.

```yaml
"xtalforms":  
  "0":
    "id": 0
    "reference": 
      "dtag": "5rgs" 
    "assemblies": 
      "0": 
        "id": 0
        "reference_assembly": 0
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A"
            "triplet": "x,y,z"
          "1":  # Now there is a second generator: this creates the second chain, B, by applying a symmetry 
                # operation to chain A 
            "id": 1,
            "reference_chain": "B", 
            "chain": "A",
            "triplet": "-x,y,-z"
```

The next level of complexity is a dataset which features multiple crystalforms. Here we add a second dimer, although this time the assembly is not generated by 

```yaml
"xtalforms": 
  "0":
    "id": 0
    "reference": 
      "dtag": "5rgs" 
    "assemblies": 
      "0": 
        "id": 0
        "reference_assembly": 0
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A"
            "triplet": "x,y,z"
          
          "1": 
            "id": 1,
            "reference_chain": "B",
            "chain": "A",
            "triplet": "-x,y,-z"
  "1": 
    "id": 1
    "reference": 
      "dtag": "Mpro-J0162" 
    "assemblies": 
      "0": 
        "id": 0
        "reference_assembly": 1
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A"
            "triplet": "x,y,z"
          "1": 
            "id": 1
            "reference_chain": "B"
            "chain": "B"  # Notice this time the B chain of the dimer is generated by the identity operation applied to 
                          # given B chain, rather than a symmetry operation on the A chain
            "triplet": "x,y,z"
```

The most complicated systems may feature multiple assemblies in the same crystalform: for example Mpro has a crystalform in which two dimers are present.

```yaml
"xtalforms":  
  "2": 
    "id": 2
    "reference": 
      "dtag": "8dz9" 
    "assemblies": 
      "0":  # First dimer
        "id": 0
        "reference_assembly": 1
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A",
            "triplet": "x,y,z"
          "1": 
            "id": 1
            "reference_chain": "B"
            "chain": "B"
            "triplet": "x,y,z"
      "1":  # Second dimer
        "id": 1
        "reference_assembly": 1
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "C"
            "triplet": "x,y,z"
          "1": 
            "id": 1
            "reference_chain": "B"
            "chain": "D"
            "triplet": "x,y,z"
```

Putting these all together...

```yaml
"xtalforms":  
  "0":
    "id": 0
    "reference": 
      "dtag": "5rgs" 
    "assemblies": 
      "0": 
        "id": 0
        "reference_assembly": 0
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A"
            "triplet": "x,y,z"
          
          "1": 
            "id": 1,
            "reference_chain": "B",
            "chain": "A",
            "triplet": "-x,y,-z"
  "1": 
    "id": 1
    "reference": 
      "dtag": "Mpro-J0162" 
    "assemblies": 
      "0": 
        "id": 0
        "reference_assembly": 1
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A"
            "triplet": "x,y,z"
          "1": 
            "id": 1
            "reference_chain": "B"
            "chain": "B"
            "triplet": "x,y,z"
  "2": 
    "id": 2
    "reference": 
      "dtag": "8dz9" 
    "assemblies": 
      "0": 
        "id": 0
        "reference_assembly": 1
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A",
            "triplet": "x,y,z"
          "1": 
            "id": 1
            "reference_chain": "B"
            "chain": "B"
            "triplet": "x,y,z"
      "1": 
        "id": 1
        "reference_assembly": 1
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "C"
            "triplet": "x,y,z"
          "1": 
            "id": 1
            "reference_chain": "B"
            "chain": "D"
            "triplet": "x,y,z"
  "3": 
    "id": 3
    "reference": 
      "dtag": "8e1y" 
    "assemblies": 
      "0": 
        "id": 0
        "reference_assembly": 1
        "generators": 
          "0": 
            "id": 0
            "reference_chain": "A"
            "chain": "A"
            "triplet": "x,y,z"
          "1": 
            "id": 1
            "reference_chain": "B"
            "chain": "B"
            "triplet": "x,y,z"

```